# Talkify

A Flutter chat application powered by Firebase with Google Sign-In, real-time messaging, smart reply suggestions, and media sharing.

## Overview
- **Platforms**: Android, iOS, Web, macOS, Windows, Linux (Flutter multi-platform)
- **Auth**: Google Sign-In via Firebase Authentication
- **Database**: Cloud Firestore (users, contacts, chats)
- **Storage**: Firebase Storage (profile pictures, chat images)
- **Realtime**: Streams for user lists and chat messages
- **Smart Replies**: `google_mlkit_smart_reply` suggestions in chat

## Features
- **Google Sign-In** authentication
- **User profiles** with avatar, name, about, presence (online/last active)
- **Add contacts** by email; maintains `my_users` per user
- **1:1 chat** with text and image messages
- **Read receipts** and last message preview (via streams)
- **Emoji picker** for composing messages
- **Smart Reply suggestions** using on-device ML Kit
- **Profile photo upload** to Firebase Storage
- **Responsive UI** with search on home screen

## Project Structure
```
lib/
  main.dart                     # App bootstrap, Firebase init, route to Home/Login
  firebase_options.dart         # Generated by FlutterFire CLI
  api/
    apis.dart                   # Firebase wrappers (auth, Firestore, Storage)
  modals/
    chat_user.dart              # User model
    messages.dart               # Message model + Type enum
  screens/
    auth/login_screen.dart      # Google Sign-In flow
    home_screen.dart            # User list, search, add contact
    chat_screen.dart            # Conversation UI + Smart Reply + media
    others_profile_screen.dart  # View other user's profile
    profile_screen.dart         # Current user's profile
  widgets/
    chat_card.dart              # User row with last message etc.
    message_card.dart           # Message bubble for text/image
```

## Data Model (Firestore)
- Collection `users/{uid}`: fields
  - `id`, `name`, `email`, `about`, `image`, `created_at`, `is_online`, `last_active`, `push_token`
- Subcollection `users/{uid}/my_users/{peerUid}`: empty doc indicates contact
- Collection `chats/{conversationId}/messages/{messageId}`: fields
  - `toId`, `fromId`, `msg`, `type` (text|image), `read`, `sent`
- Conversation ID: `min(uidHash, peerUidHash)` first → `${uid}_${peerUid}` or `${peerUid}_${uid}`

## Requirements
- Flutter SDK 3.2+ (Dart >= 3.2.4)
- A Firebase project configured for your target platforms
- Xcode (for iOS/macOS), Android Studio/SDK (for Android), Chrome (for Web)

## Dependencies (key)
- `firebase_core`, `firebase_auth`, `cloud_firestore`, `firebase_storage`
- `google_sign_in`
- `cached_network_image`, `image_picker`, `emoji_picker_flutter`
- `google_mlkit_smart_reply`

See `pubspec.yaml` for full list.

## Setup
1) Clone and install packages
```bash
flutter pub get
```

2) Configure Firebase (all platforms you need)
- Install FlutterFire CLI if not already
```bash
dart pub global activate flutterfire_cli
```
- Login and configure
```bash
firebase login
flutterfire configure --project <your-firebase-project-id>
```
This generates/updates `lib/firebase_options.dart` and native configs.

3) Add platform-specific config files
- Android: place `android/app/google-services.json`
- iOS: place `ios/Runner/GoogleService-Info.plist`
- macOS: use iOS plist or platform-appropriate setup as generated
- Web: `web/index.html` includes Firebase initialization via `firebase_options.dart`

4) Android setup
- Ensure Gradle plugin and Kotlin versions are compatible (already scaffolded)
- Min SDK 21 per `pubspec.yaml` launcher icons config
- Verify `android/build.gradle` and `android/app/build.gradle` apply Google services plugin

5) iOS/macOS setup
- Open `ios/Runner.xcworkspace` and ensure signing team set
- Run `pod install` in `ios/` and `macos/` if needed

## Running
- Android: `flutter run -d android`
- iOS: `flutter run -d ios`
- Web: `flutter run -d chrome`
- macOS/Windows/Linux: `flutter run -d macos|windows|linux`

The app chooses initial screen based on auth state:
- Signed-in → `HomeScreen`
- Not signed-in → `LoginScreen`

## Building
- Android APK: `flutter build apk --release`
- iOS: `flutter build ios --release` (then archive via Xcode)
- Web: `flutter build web`


## Troubleshooting
- If Google Sign-In closes immediately on iOS, ensure reversed client ID is added to URL schemes in Xcode.
- If messages don’t appear, confirm Firestore indexes and that `users/{uid}/my_users` contains the peer.
- If images fail to upload, check Firebase Storage rules and that the app has Photos permissions.
- Ensure network connectivity before Google Sign-In; the app shows a snackbar on failure.
